# ç³»ç»Ÿä¼˜åŒ–ä¸æ¼”è¿›è·¯çº¿å›¾
## é’ç»¿æ°¢èƒ½ç‰©æ–™ç®¡ç†ç³»ç»Ÿ (MMS) - æŠ€æœ¯å®¡è®¡æŠ¥å‘Š

**å®¡è®¡æ—¥æœŸ**: 2025å¹´12æœˆ  
**å®¡è®¡äººå‘˜**: CTO/é¦–å¸­æ¶æ„å¸ˆ  
**é¡¹ç›®ç‰ˆæœ¬**: v1.0  
**æ–‡æ¡£ç‰ˆæœ¬**: v1.0

---

## æ‰§è¡Œæ‘˜è¦

### æ€»ä½“å¥åº·åº¦è¯„åˆ†

| ç»´åº¦ | è¯„åˆ† | çŠ¶æ€ | è¯´æ˜ |
|------|------|------|------|
| **æ€§èƒ½ä¸å¯æ‰©å±•æ€§** | 6.5/10 | âš ï¸ ä¸­ç­‰ | SQLiteæ— ç´¢å¼•ä¼˜åŒ–ï¼Œå­˜åœ¨åµŒå¥—æŸ¥è¯¢æ€§èƒ½é—®é¢˜ |
| **å®‰å…¨ä¸å¥å£®æ€§** | 5.5/10 | âš ï¸ éœ€æ”¹è¿› | JWTå¯†é’¥é»˜è®¤å€¼ã€ç¼ºå°‘è¾“å…¥éªŒè¯ã€é”™è¯¯å¤„ç†ä¸å®Œå–„ |
| **ä»£ç è´¨é‡** | 7.0/10 | âœ… è‰¯å¥½ | ç»“æ„æ¸…æ™°ä½†å­˜åœ¨å›è°ƒåœ°ç‹±ï¼Œç¼ºå°‘æµ‹è¯•è¦†ç›– |
| **æ¶æ„è®¾è®¡** | 6.0/10 | âš ï¸ ä¸­ç­‰ | å•ä½“æ¶æ„åˆç†ï¼Œä½†å®¹å™¨åŒ–å°±ç»ªåº¦ä½ |

**ç»¼åˆè¯„åˆ†**: **6.25/10** - ä¸­ç­‰åä¸Šï¼Œå…·å¤‡ç”Ÿäº§å¯ç”¨æ€§ï¼Œä½†éœ€ç³»ç»Ÿæ€§ä¼˜åŒ–

### æ ¸å¿ƒé£é™©è¯†åˆ«

#### ğŸ”´ P0 - ç´§æ€¥é£é™©ï¼ˆéœ€ç«‹å³å¤„ç†ï¼‰

1. **JWTå¯†é’¥å®‰å…¨é£é™©**
   - **ä½ç½®**: `backend/middleware/authMiddleware.js:15`, `backend/routes/authRoutes.js:119`
   - **é—®é¢˜**: ä½¿ç”¨ç¡¬ç¼–ç é»˜è®¤å¯†é’¥ `'your-super-secret-jwt-key-change-in-production'`
   - **å½±å“**: ç”Ÿäº§ç¯å¢ƒå­˜åœ¨ä¸¥é‡å®‰å…¨æ¼æ´ï¼Œä»¤ç‰Œå¯è¢«ä¼ªé€ 
   - **å»ºè®®**: ç«‹å³é€šè¿‡ç¯å¢ƒå˜é‡é…ç½®å¼ºå¯†é’¥ï¼Œå¹¶å¼ºåˆ¶è¦æ±‚ç”Ÿäº§ç¯å¢ƒå¿…é¡»è®¾ç½®

2. **æ•°æ®åº“ç´¢å¼•ç¼ºå¤±**
   - **ä½ç½®**: `backend/database/database.js` - æ‰€æœ‰è¡¨å®šä¹‰
   - **é—®é¢˜**: å…³é”®æŸ¥è¯¢å­—æ®µï¼ˆå¦‚ `username`, `material_code`, `transaction_code`, `status`, `created_at`ï¼‰æœªå»ºç«‹ç´¢å¼•
   - **å½±å“**: æ•°æ®é‡å¢é•¿åæŸ¥è¯¢æ€§èƒ½æ€¥å‰§ä¸‹é™ï¼Œå¯èƒ½å¯¼è‡´è¶…æ—¶
   - **å»ºè®®**: ä¸ºé«˜é¢‘æŸ¥è¯¢å­—æ®µåˆ›å»ºç´¢å¼•ï¼Œç‰¹åˆ«æ˜¯å¤–é”®å’ŒçŠ¶æ€å­—æ®µ

3. **é”™è¯¯ä¿¡æ¯æ³„éœ²é£é™©**
   - **ä½ç½®**: `backend/server.js:49-55`
   - **é—®é¢˜**: å…¨å±€é”™è¯¯å¤„ç†å¯èƒ½è¿”å›å®Œæ•´é”™è¯¯å †æ ˆç»™å®¢æˆ·ç«¯
   - **å½±å“**: å¯èƒ½æ³„éœ²æ•°æ®åº“ç»“æ„ã€æ–‡ä»¶è·¯å¾„ç­‰æ•æ„Ÿä¿¡æ¯
   - **å»ºè®®**: ç”Ÿäº§ç¯å¢ƒä»…è¿”å›é€šç”¨é”™è¯¯ä¿¡æ¯ï¼Œè¯¦ç»†é”™è¯¯è®°å½•åˆ°æ—¥å¿—

#### ğŸŸ¡ P1 - é«˜ä¼˜å…ˆçº§ï¼ˆè¿‘æœŸå¤„ç†ï¼‰

4. **åµŒå¥—å›è°ƒå¯¼è‡´çš„æ€§èƒ½é—®é¢˜**
   - **ä½ç½®**: `backend/routes/dashboardRoutes.js:11-87`
   - **é—®é¢˜**: 5å±‚åµŒå¥—å›è°ƒï¼Œæ— æ³•å¹¶è¡Œæ‰§è¡ŒæŸ¥è¯¢
   - **å½±å“**: DashboardåŠ è½½æ—¶é—´éšæ•°æ®é‡çº¿æ€§å¢é•¿
   - **å»ºè®®**: é‡æ„ä¸ºPromise.allå¹¶è¡ŒæŸ¥è¯¢ï¼Œé¢„è®¡æ€§èƒ½æå‡60-80%

5. **ç¼ºå°‘è¾“å…¥éªŒè¯åº“**
   - **ä½ç½®**: æ‰€æœ‰è·¯ç”±æ–‡ä»¶
   - **é—®é¢˜**: æ‰‹åŠ¨éªŒè¯è¾“å…¥ï¼Œæ˜“é—æ¼è¾¹ç•Œæƒ…å†µï¼Œå­˜åœ¨SQLæ³¨å…¥é£é™©ï¼ˆè™½ç„¶ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œä½†éªŒè¯ä¸å……åˆ†ï¼‰
   - **å½±å“**: å¯èƒ½æ¥å—éæ³•è¾“å…¥ï¼Œå¯¼è‡´æ•°æ®å¼‚å¸¸æˆ–å®‰å…¨æ¼æ´
   - **å»ºè®®**: å¼•å…¥ `express-validator` è¿›è¡Œç»Ÿä¸€è¾“å…¥éªŒè¯

6. **å‰ç«¯æ„å»ºæœªä¼˜åŒ–**
   - **ä½ç½®**: `frontend/vite.config.js`
   - **é—®é¢˜**: æœªé…ç½®ä»£ç åˆ†å‰²ã€æ‡’åŠ è½½ã€èµ„æºå‹ç¼©
   - **å½±å“**: é¦–å±åŠ è½½æ—¶é—´é•¿ï¼Œç”¨æˆ·ä½“éªŒå·®
   - **å»ºè®®**: é…ç½®è·¯ç”±æ‡’åŠ è½½ã€ç»„ä»¶æŒ‰éœ€åŠ è½½ã€ç”Ÿäº§æ„å»ºä¼˜åŒ–

#### ğŸŸ¢ P2 - ä¼˜åŒ–é¡¹ï¼ˆä¸­æœŸè§„åˆ’ï¼‰

7. **JWTåˆ·æ–°æœºåˆ¶ç¼ºå¤±**
8. **ç¼ºå°‘å•å…ƒæµ‹è¯•å’Œé›†æˆæµ‹è¯•**
9. **æ—¥å¿—ç³»ç»Ÿä¸å®Œå–„**
10. **å®¹å™¨åŒ–å°±ç»ªåº¦ä½**

---

## ç¬¬ä¸€éƒ¨åˆ†ï¼šæ€§èƒ½ä¸å¯æ‰©å±•æ€§å®¡è®¡

### 1.1 æ•°æ®åº“å±‚é¢åˆ†æ

#### å½“å‰çŠ¶æ€

**æ•°æ®åº“**: SQLite3 5.1  
**æ•°æ®è¡¨**: 8å¼ è¡¨ï¼ˆusers, materials, inventory_transactions, stock_history, stocktaking_tasks, stocktaking_items, operation_logsï¼‰  
**è¿æ¥ç®¡ç†**: å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€å…±äº«ä¸€ä¸ªè¿æ¥

#### å‘ç°çš„é—®é¢˜

##### ğŸ”´ é—®é¢˜1: ç´¢å¼•ç¼ºå¤±

**å½±å“æŸ¥è¯¢æ€§èƒ½çš„è¡¨å’Œå­—æ®µ**:

| è¡¨å | å­—æ®µ | æŸ¥è¯¢é¢‘ç‡ | å»ºè®®ç´¢å¼•ç±»å‹ |
|------|------|---------|------------|
| `users` | `username` | æé«˜ï¼ˆç™»å½•ã€æ³¨å†Œï¼‰ | UNIQUE INDEX |
| `materials` | `material_code` | æé«˜ï¼ˆCRUDï¼‰ | UNIQUE INDEX |
| `materials` | `category` | é«˜ï¼ˆç­›é€‰ï¼‰ | INDEX |
| `materials` | `created_at` | é«˜ï¼ˆæ’åºï¼‰ | INDEX |
| `inventory_transactions` | `status` | æé«˜ï¼ˆç­›é€‰ï¼‰ | INDEX |
| `inventory_transactions` | `transaction_type` | é«˜ï¼ˆç­›é€‰ï¼‰ | INDEX |
| `inventory_transactions` | `applicant_id` | é«˜ï¼ˆæƒé™è¿‡æ»¤ï¼‰ | INDEX |
| `inventory_transactions` | `created_at` | é«˜ï¼ˆæ’åºï¼‰ | INDEX |
| `stock_history` | `material_id` | é«˜ï¼ˆå…³è”æŸ¥è¯¢ï¼‰ | INDEX |
| `operation_logs` | `user_id` | é«˜ï¼ˆå…³è”æŸ¥è¯¢ï¼‰ | INDEX |
| `operation_logs` | `created_at` | é«˜ï¼ˆæ—¶é—´èŒƒå›´æŸ¥è¯¢ï¼‰ | INDEX |

**æ€§èƒ½å½±å“è¯„ä¼°**:
- **å½“å‰**: å…¨è¡¨æ‰«æï¼Œæ—¶é—´å¤æ‚åº¦ O(n)
- **ä¼˜åŒ–å**: ç´¢å¼•æŸ¥æ‰¾ï¼Œæ—¶é—´å¤æ‚åº¦ O(log n)
- **é¢„æœŸæå‡**: æ•°æ®é‡1000æ¡æ—¶ï¼ŒæŸ¥è¯¢é€Ÿåº¦æå‡ **10-50å€**

**ä¿®å¤æ–¹æ¡ˆ**:
```sql
-- ç”¨æˆ·è¡¨ç´¢å¼•
CREATE UNIQUE INDEX IF NOT EXISTS idx_users_username ON users(username);
CREATE INDEX IF NOT EXISTS idx_users_role ON users(role);

-- ç‰©æ–™è¡¨ç´¢å¼•
CREATE UNIQUE INDEX IF NOT EXISTS idx_materials_code ON materials(material_code);
CREATE INDEX IF NOT EXISTS idx_materials_category ON materials(category);
CREATE INDEX IF NOT EXISTS idx_materials_created_at ON materials(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_materials_created_by ON materials(created_by);

-- å‡ºå…¥åº“å•è¡¨ç´¢å¼•
CREATE UNIQUE INDEX IF NOT EXISTS idx_transactions_code ON inventory_transactions(transaction_code);
CREATE INDEX IF NOT EXISTS idx_transactions_status ON inventory_transactions(status);
CREATE INDEX IF NOT EXISTS idx_transactions_type ON inventory_transactions(transaction_type);
CREATE INDEX IF NOT EXISTS idx_transactions_applicant ON inventory_transactions(applicant_id);
CREATE INDEX IF NOT EXISTS idx_transactions_material ON inventory_transactions(material_id);
CREATE INDEX IF NOT EXISTS idx_transactions_created_at ON inventory_transactions(created_at DESC);

-- åº“å­˜å†å²è¡¨ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_stock_history_material ON stock_history(material_id);
CREATE INDEX IF NOT EXISTS idx_stock_history_created_at ON stock_history(created_at DESC);

-- æ“ä½œæ—¥å¿—è¡¨ç´¢å¼•
CREATE INDEX IF NOT EXISTS idx_operation_logs_user ON operation_logs(user_id);
CREATE INDEX IF NOT EXISTS idx_operation_logs_created_at ON operation_logs(created_at DESC);
CREATE INDEX IF NOT EXISTS idx_operation_logs_module ON operation_logs(module, action);
```

##### ğŸŸ¡ é—®é¢˜2: åµŒå¥—å›è°ƒå¯¼è‡´çš„ä¸²è¡ŒæŸ¥è¯¢

**ä½ç½®**: `backend/routes/dashboardRoutes.js:11-87`

**å½“å‰ä»£ç é—®é¢˜**:
```javascript
// 5å±‚åµŒå¥—å›è°ƒï¼Œä¸²è¡Œæ‰§è¡Œ
db.get('SELECT COUNT(*) as total FROM materials', (err, materialCount) => {
  db.get('SELECT COUNT(*) as total FROM inventory_transactions WHERE status = ?', 
    ['pending'], (err, pendingCount) => {
      db.get('SELECT COUNT(*) as total FROM inventory_transactions WHERE DATE(created_at) = ?',
        [today], (err, todayCount) => {
          db.get('SELECT COUNT(*) as total FROM materials WHERE current_stock <= min_stock',
            (err, lowStockCount) => {
              db.all('SELECT SUM(...) as total_value FROM materials...',
                (err, valueResult) => {
                  // è¿”å›ç»“æœ
                });
            });
        });
    });
});
```

**æ€§èƒ½å½±å“**:
- **å½“å‰**: 5ä¸ªæŸ¥è¯¢ä¸²è¡Œæ‰§è¡Œï¼Œæ€»è€—æ—¶ = T1 + T2 + T3 + T4 + T5 â‰ˆ 50-100ms
- **ä¼˜åŒ–å**: å¹¶è¡Œæ‰§è¡Œï¼Œæ€»è€—æ—¶ = max(T1, T2, T3, T4, T5) â‰ˆ 10-20ms
- **é¢„æœŸæå‡**: **60-80%** æ€§èƒ½æå‡

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
router.get('/stats', async (req, res, next) => {
  try {
    const [
      materialCount,
      pendingCount,
      todayCount,
      lowStockCount,
      valueResult
    ] = await Promise.all([
      dbGet('SELECT COUNT(*) as total FROM materials'),
      dbGet('SELECT COUNT(*) as total FROM inventory_transactions WHERE status = ?', ['pending']),
      dbGet('SELECT COUNT(*) as total FROM inventory_transactions WHERE DATE(created_at) = ?', [today]),
      dbGet('SELECT COUNT(*) as total FROM materials WHERE current_stock <= min_stock AND min_stock > 0'),
      dbAll('SELECT SUM(...) as total_value FROM materials...')
    ]);

    res.json({
      success: true,
      data: {
        totalMaterials: materialCount.total,
        pendingTransactions: pendingCount.total,
        todayTransactions: todayCount.total,
        lowStockMaterials: lowStockCount.total,
        totalInventoryValue: valueResult[0]?.total_value || 0
      }
    });
  } catch (error) {
    next(error);
  }
});
```

##### ğŸŸ¡ é—®é¢˜3: SQLiteè¿æ¥ç®¡ç†

**å½“å‰çŠ¶æ€**: å•ä¾‹æ¨¡å¼ï¼Œå…¨å±€å…±äº«ä¸€ä¸ªè¿æ¥

**æ½œåœ¨é—®é¢˜**:
- SQLiteæ˜¯æ–‡ä»¶æ•°æ®åº“ï¼Œå¹¶å‘å†™å…¥æ€§èƒ½æœ‰é™
- å½“å‰å®ç°åœ¨é«˜å¹¶å‘ä¸‹å¯èƒ½å‡ºç°é”ç­‰å¾…
- ç¼ºå°‘è¿æ¥æ± ç®¡ç†

**å»ºè®®**:
- **çŸ­æœŸ**: ä¿æŒå•ä¾‹æ¨¡å¼ï¼Œä½†æ·»åŠ WALæ¨¡å¼ï¼ˆWrite-Ahead Loggingï¼‰æå‡å¹¶å‘æ€§èƒ½
- **ä¸­æœŸ**: è¯„ä¼°è¿ç§»è‡³PostgreSQL/MySQLçš„å¿…è¦æ€§ï¼ˆè§æ¶æ„æ¼”è¿›éƒ¨åˆ†ï¼‰

**WALæ¨¡å¼å¯ç”¨**:
```javascript
db.run('PRAGMA journal_mode = WAL');
db.run('PRAGMA synchronous = NORMAL');
db.run('PRAGMA cache_size = -64000'); // 64MB cache
```

#### æ•°æ®åº“è¿ç§»è¯„ä¼°

**SQLite â†’ PostgreSQL/MySQL è¿ç§»æ—¶æœº**:

| æŒ‡æ ‡ | SQLiteé€‚ç”¨ | å»ºè®®è¿ç§» |
|------|-----------|---------|
| æ•°æ®é‡ | < 100ä¸‡æ¡ | > 100ä¸‡æ¡ |
| å¹¶å‘ç”¨æˆ· | < 50 | > 50 |
| å†™å…¥é¢‘ç‡ | < 100æ¬¡/ç§’ | > 100æ¬¡/ç§’ |
| æ•°æ®å¤§å° | < 10GB | > 10GB |

**å½“å‰è¯„ä¼°**: ç³»ç»Ÿå¤„äºSQLiteé€‚ç”¨èŒƒå›´å†…ï¼Œä½†éœ€ä¸ºæœªæ¥è¿ç§»åšå‡†å¤‡

### 1.2 APIå±‚é¢åˆ†æ

#### å½“å‰çŠ¶æ€

**æ¡†æ¶**: Express 4.18  
**ä¸­é—´ä»¶**: CORS, body-parser  
**è·¯ç”±**: 8ä¸ªè·¯ç”±æ¨¡å—ï¼ŒRESTfulè®¾è®¡

#### å‘ç°çš„é—®é¢˜

##### ğŸŸ¡ é—®é¢˜1: ç¼ºå°‘å“åº”å‹ç¼©

**å½±å“**: JSONå“åº”æœªå‹ç¼©ï¼Œç½‘ç»œä¼ è¾“æ•ˆç‡ä½

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
const compression = require('compression');
app.use(compression());
```

**é¢„æœŸæ•ˆæœ**: å“åº”ä½“ç§¯å‡å°‘ **60-80%**

##### ğŸŸ¡ é—®é¢˜2: ç¼ºå°‘ETagç¼“å­˜

**å½±å“**: é™æ€æ•°æ®å’Œåˆ—è¡¨æŸ¥è¯¢æ— æ³•åˆ©ç”¨æµè§ˆå™¨ç¼“å­˜

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
const etag = require('etag');
app.use((req, res, next) => {
  if (req.method === 'GET') {
    res.set('Cache-Control', 'private, max-age=60');
  }
  next();
});
```

##### ğŸŸ¡ é—®é¢˜3: ç¼ºå°‘è¯·æ±‚é™æµ

**å½±å“**: æ— æ³•é˜²æ­¢æ¶æ„è¯·æ±‚å’ŒDDoSæ”»å‡»

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
const rateLimit = require('express-rate-limit');
const limiter = rateLimit({
  windowMs: 15 * 60 * 1000, // 15åˆ†é’Ÿ
  max: 100 // é™åˆ¶100æ¬¡è¯·æ±‚
});
app.use('/api/', limiter);
```

##### ğŸŸ¢ é—®é¢˜4: åˆ†é¡µæŸ¥è¯¢ä¼˜åŒ–

**å½“å‰å®ç°**: ä½¿ç”¨ `LIMIT` å’Œ `OFFSET`ï¼Œå¤§æ•°æ®é‡æ—¶æ€§èƒ½ä¸‹é™

**å»ºè®®**: ä½¿ç”¨æ¸¸æ ‡åˆ†é¡µï¼ˆCursor-based Paginationï¼‰
```javascript
// å½“å‰: OFFSET 10000 å¾ˆæ…¢
// ä¼˜åŒ–: WHERE id > last_id LIMIT 20
```

### 1.3 å‰ç«¯å±‚é¢åˆ†æ

#### å½“å‰çŠ¶æ€

**æ„å»ºå·¥å…·**: Vite 5  
**æ¡†æ¶**: Vue 3 + Element Plus  
**å›¾è¡¨åº“**: ECharts 5.4

#### å‘ç°çš„é—®é¢˜

##### ğŸŸ¡ é—®é¢˜1: æœªé…ç½®ä»£ç åˆ†å‰²

**å½“å‰**: æ‰€æœ‰ä»£ç æ‰“åŒ…åˆ°ä¸€ä¸ªbundle

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
// vite.config.js
export default defineConfig({
  build: {
    rollupOptions: {
      output: {
        manualChunks: {
          'element-plus': ['element-plus'],
          'echarts': ['echarts'],
          'vue-vendor': ['vue', 'vue-router', 'pinia']
        }
      }
    },
    chunkSizeWarningLimit: 1000
  }
});
```

**é¢„æœŸæ•ˆæœ**: é¦–å±åŠ è½½æ—¶é—´å‡å°‘ **40-60%**

##### ğŸŸ¡ é—®é¢˜2: è·¯ç”±æœªæ‡’åŠ è½½

**å½“å‰**: æ‰€æœ‰è·¯ç”±ç»„ä»¶åœ¨åˆå§‹åŠ è½½æ—¶å¯¼å…¥

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
// router/index.js
{
  path: 'dashboard',
  component: () => import('@/views/Dashboard.vue') // å·²å®ç°
}
// ç¡®è®¤æ‰€æœ‰è·¯ç”±éƒ½ä½¿ç”¨åŠ¨æ€å¯¼å…¥
```

##### ğŸŸ¡ é—®é¢˜3: EChartså¤§æ•°æ®é‡æ€§èƒ½

**ä½ç½®**: `frontend/src/views/Dashboard.vue`

**æ½œåœ¨é—®é¢˜**: å½“æ•°æ®ç‚¹è¶…è¿‡1000ä¸ªæ—¶ï¼Œå›¾è¡¨æ¸²æŸ“å¯èƒ½å¡é¡¿

**å»ºè®®**: 
- æ•°æ®é‡‡æ ·ï¼ˆSamplingï¼‰
- è™šæ‹Ÿæ»šåŠ¨ï¼ˆVirtual Scrollingï¼‰
- Web Workerå¤„ç†æ•°æ®

##### ğŸŸ¢ é—®é¢˜4: å›¾ç‰‡èµ„æºæœªä¼˜åŒ–

**å½“å‰**: æœªä½¿ç”¨WebPæ ¼å¼ï¼Œæœªé…ç½®å›¾ç‰‡å‹ç¼©

**å»ºè®®**: 
- ä½¿ç”¨ `vite-plugin-imagemin` å‹ç¼©å›¾ç‰‡
- é…ç½®WebPæ ¼å¼æ”¯æŒ

---

## ç¬¬äºŒéƒ¨åˆ†ï¼šå®‰å…¨ä¸å¥å£®æ€§å®¡è®¡

### 2.1 è¾“å…¥éªŒè¯ä¸æ¶ˆæ¯’

#### å½“å‰çŠ¶æ€

**éªŒè¯æ–¹å¼**: æ‰‹åŠ¨éªŒè¯ï¼Œä½¿ç”¨ `if` è¯­å¥æ£€æŸ¥å¿…å¡«å­—æ®µå’Œæ ¼å¼

#### å‘ç°çš„é—®é¢˜

##### ğŸ”´ é—®é¢˜1: ç¼ºå°‘ç»Ÿä¸€éªŒè¯åº“

**ä½ç½®**: æ‰€æœ‰è·¯ç”±æ–‡ä»¶

**é—®é¢˜ç¤ºä¾‹** (`backend/routes/inventoryRoutes.js:30-52`):
```javascript
// æ‰‹åŠ¨éªŒè¯ï¼Œæ˜“é—æ¼è¾¹ç•Œæƒ…å†µ
if (!transactionType || !materialId || !quantity) {
  return res.status(400).json({...});
}
if (!['in', 'out'].includes(transactionType)) {
  return res.status(400).json({...});
}
if (quantity <= 0) {
  return res.status(400).json({...});
}
```

**é£é™©**:
- æœªéªŒè¯æ•°æ®ç±»å‹ï¼ˆquantityå¯èƒ½æ˜¯å­—ç¬¦ä¸²ï¼‰
- æœªéªŒè¯æ•°å€¼èŒƒå›´ï¼ˆquantityå¯èƒ½ä¸ºè´Ÿæ•°æˆ–æå¤§å€¼ï¼‰
- æœªéªŒè¯SQLæ³¨å…¥ï¼ˆè™½ç„¶ä½¿ç”¨å‚æ•°åŒ–æŸ¥è¯¢ï¼Œä½†éªŒè¯ä¸å……åˆ†ï¼‰
- æœªéªŒè¯XSSæ”»å‡»ï¼ˆæ–‡æœ¬å­—æ®µå¯èƒ½åŒ…å«æ¶æ„è„šæœ¬ï¼‰

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
const { body, validationResult } = require('express-validator');

router.post('/',
  [
    body('transactionType').isIn(['in', 'out']).withMessage('ç±»å‹å¿…é¡»æ˜¯ in æˆ– out'),
    body('materialId').isInt({ min: 1 }).withMessage('ç‰©æ–™IDå¿…é¡»æ˜¯æ­£æ•´æ•°'),
    body('quantity').isFloat({ min: 0.01 }).withMessage('æ•°é‡å¿…é¡»å¤§äº0'),
    body('unitPrice').optional().isFloat({ min: 0 }).withMessage('å•ä»·å¿…é¡»å¤§äºç­‰äº0'),
    body('remark').optional().isLength({ max: 500 }).escape().withMessage('å¤‡æ³¨é•¿åº¦ä¸èƒ½è¶…è¿‡500å­—ç¬¦')
  ],
  (req, res, next) => {
    const errors = validationResult(req);
    if (!errors.isEmpty()) {
      return res.status(400).json({
        success: false,
        message: 'è¾“å…¥éªŒè¯å¤±è´¥',
        errors: errors.array()
      });
    }
    // å¤„ç†è¯·æ±‚
  }
);
```

##### ğŸŸ¡ é—®é¢˜2: æ–‡ä»¶ä¸Šä¼ å®‰å…¨

**ä½ç½®**: `backend/routes/profileRoutes.js`

**é—®é¢˜**:
- æœªéªŒè¯æ–‡ä»¶ç±»å‹ï¼ˆä»…é€šè¿‡æ‰©å±•åï¼‰
- æœªé™åˆ¶æ–‡ä»¶å¤§å°
- æœªæ‰«ææ¶æ„æ–‡ä»¶

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
const upload = multer({
  storage: multer.diskStorage({...}),
  limits: { fileSize: 2 * 1024 * 1024 }, // 2MB
  fileFilter: (req, file, cb) => {
    const allowedTypes = ['image/jpeg', 'image/png', 'image/gif'];
    if (allowedTypes.includes(file.mimetype)) {
      cb(null, true);
    } else {
      cb(new Error('ä¸æ”¯æŒçš„æ–‡ä»¶ç±»å‹'));
    }
  }
});
```

### 2.2 èº«ä»½ä¸è®¿é—®æ§åˆ¶

#### å½“å‰çŠ¶æ€

**è®¤è¯æ–¹å¼**: JWT Token  
**æƒé™æ§åˆ¶**: ä¸‰çº§è§’è‰²æ¨¡å‹ï¼ˆsystem_admin, inventory_manager, regular_userï¼‰

#### å‘ç°çš„é—®é¢˜

##### ğŸ”´ é—®é¢˜1: JWTå¯†é’¥ç¡¬ç¼–ç 

**ä½ç½®**: 
- `backend/middleware/authMiddleware.js:15`
- `backend/routes/authRoutes.js:119`

**é—®é¢˜**:
```javascript
process.env.JWT_SECRET || 'your-super-secret-jwt-key-change-in-production'
```

**é£é™©**: 
- ç”Ÿäº§ç¯å¢ƒä½¿ç”¨é»˜è®¤å¯†é’¥ï¼Œä»¤ç‰Œå¯è¢«ä¼ªé€ 
- å¯†é’¥æœªå®šæœŸè½®æ¢

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
// å¼ºåˆ¶è¦æ±‚ç¯å¢ƒå˜é‡
const JWT_SECRET = process.env.JWT_SECRET;
if (!JWT_SECRET || JWT_SECRET === 'your-super-secret-jwt-key-change-in-production') {
  throw new Error('JWT_SECRET must be set in production environment');
}
```

##### ğŸŸ¡ é—®é¢˜2: JWTåˆ·æ–°æœºåˆ¶ç¼ºå¤±

**å½“å‰**: Tokenæœ‰æ•ˆæœŸ7å¤©ï¼Œæ— åˆ·æ–°æœºåˆ¶

**é—®é¢˜**:
- Tokenè¿‡æœŸåéœ€é‡æ–°ç™»å½•
- æ— æ³•ä¸»åŠ¨æ’¤é”€Token

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
// å®ç°Refresh Tokenæœºåˆ¶
const refreshToken = jwt.sign(
  { id: user.id, type: 'refresh' },
  process.env.JWT_REFRESH_SECRET,
  { expiresIn: '30d' }
);

// æ·»åŠ åˆ·æ–°ç«¯ç‚¹
router.post('/refresh', (req, res) => {
  const { refreshToken } = req.body;
  // éªŒè¯refreshTokenï¼Œç”Ÿæˆæ–°accessToken
});
```

##### ğŸŸ¡ é—®é¢˜3: JWTé»‘åå•ç¼ºå¤±

**é—®é¢˜**: æ— æ³•ä¸»åŠ¨æ’¤é”€å·²å‘æ”¾çš„Token

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
// ä½¿ç”¨Rediså­˜å‚¨é»‘åå•
const redis = require('redis');
const client = redis.createClient();

// ç™»å‡ºæ—¶å°†TokenåŠ å…¥é»‘åå•
router.post('/logout', async (req, res) => {
  const token = req.headers['authorization'].split(' ')[1];
  const decoded = jwt.decode(token);
  await client.setex(`blacklist:${token}`, decoded.exp - Date.now() / 1000, '1');
});

// ä¸­é—´ä»¶æ£€æŸ¥é»‘åå•
const checkBlacklist = async (req, res, next) => {
  const token = req.headers['authorization']?.split(' ')[1];
  const isBlacklisted = await client.get(`blacklist:${token}`);
  if (isBlacklisted) {
    return res.status(401).json({ message: 'Tokenå·²å¤±æ•ˆ' });
  }
  next();
};
```

##### ğŸŸ¢ é—®é¢˜4: æƒé™æ£€æŸ¥ç²’åº¦

**å½“å‰**: è·¯ç”±çº§åˆ«æƒé™æ§åˆ¶

**å»ºè®®**: è€ƒè™‘æ·»åŠ èµ„æºçº§åˆ«æƒé™æ§åˆ¶ï¼ˆå¦‚ï¼šç”¨æˆ·åªèƒ½ç¼–è¾‘è‡ªå·±åˆ›å»ºçš„ç‰©æ–™ï¼‰

### 2.3 é”™è¯¯å¤„ç†

#### å½“å‰çŠ¶æ€

**é”™è¯¯å¤„ç†**: å…¨å±€é”™è¯¯å¤„ç†ä¸­é—´ä»¶ (`backend/server.js:49-55`)

#### å‘ç°çš„é—®é¢˜

##### ğŸ”´ é—®é¢˜1: é”™è¯¯ä¿¡æ¯æ³„éœ²

**ä½ç½®**: `backend/server.js:49-55`

**é—®é¢˜**:
```javascript
app.use((err, req, res, next) => {
  console.error('Error:', err);
  res.status(err.status || 500).json({
    success: false,
    message: err.message || 'Internal server error' // å¯èƒ½æ³„éœ²æ•æ„Ÿä¿¡æ¯
  });
});
```

**é£é™©**: 
- ç”Ÿäº§ç¯å¢ƒå¯èƒ½è¿”å›æ•°æ®åº“é”™è¯¯ã€æ–‡ä»¶è·¯å¾„ç­‰æ•æ„Ÿä¿¡æ¯
- é”™è¯¯å †æ ˆå¯èƒ½æš´éœ²ä»£ç ç»“æ„

**ä¿®å¤æ–¹æ¡ˆ**:
```javascript
app.use((err, req, res, next) => {
  // è®°å½•è¯¦ç»†é”™è¯¯åˆ°æ—¥å¿—
  logger.error('Error:', {
    message: err.message,
    stack: err.stack,
    url: req.url,
    method: req.method,
    ip: req.ip
  });

  // ç”Ÿäº§ç¯å¢ƒä»…è¿”å›é€šç”¨é”™è¯¯
  const isDevelopment = process.env.NODE_ENV === 'development';
  res.status(err.status || 500).json({
    success: false,
    message: isDevelopment ? err.message : 'æœåŠ¡å™¨å†…éƒ¨é”™è¯¯ï¼Œè¯·ç¨åé‡è¯•',
    ...(isDevelopment && { stack: err.stack })
  });
});
```

##### ğŸŸ¡ é—®é¢˜2: ç¼ºå°‘ç»“æ„åŒ–æ—¥å¿—

**å½“å‰**: ä½¿ç”¨ `console.log/error`

**å»ºè®®**: ä½¿ç”¨ `winston` æˆ– `pino` è¿›è¡Œç»“æ„åŒ–æ—¥å¿—
```javascript
const winston = require('winston');
const logger = winston.createLogger({
  level: 'info',
  format: winston.format.json(),
  transports: [
    new winston.transports.File({ filename: 'error.log', level: 'error' }),
    new winston.transports.File({ filename: 'combined.log' })
  ]
});
```

---

## ç¬¬ä¸‰éƒ¨åˆ†ï¼šä»£ç è´¨é‡ä¸å¯ç»´æŠ¤æ€§å®¡è®¡

### 3.1 ä»£ç ç»“æ„è¯„ä¼°

#### å½“å‰ç»“æ„

```
backend/
â”œâ”€â”€ routes/          # è·¯ç”±æ¨¡å—ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ middleware/      # ä¸­é—´ä»¶ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ database/        # æ•°æ®åº“ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
â””â”€â”€ server.js        # å…¥å£æ–‡ä»¶

frontend/
â”œâ”€â”€ views/           # é¡µé¢ç»„ä»¶ï¼ˆ8ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ components/      # å…¬å…±ç»„ä»¶ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ layouts/         # å¸ƒå±€ç»„ä»¶ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ router/          # è·¯ç”±é…ç½®ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
â”œâ”€â”€ stores/          # çŠ¶æ€ç®¡ç†ï¼ˆ1ä¸ªæ–‡ä»¶ï¼‰
â””â”€â”€ utils/           # å·¥å…·å‡½æ•°ï¼ˆ2ä¸ªæ–‡ä»¶ï¼‰
```

#### è¯„ä¼°ç»“æœ

**ä¼˜ç‚¹**:
- âœ… æ¨¡å—åˆ’åˆ†æ¸…æ™°ï¼ŒèŒè´£æ˜ç¡®
- âœ… å‰åç«¯åˆ†ç¦»ï¼ŒAPIå¥‘çº¦æ¸…æ™°
- âœ… ä½¿ç”¨ç°ä»£æ¡†æ¶ï¼ˆVue 3, Expressï¼‰

**é—®é¢˜**:

##### ğŸŸ¡ é—®é¢˜1: å›è°ƒåœ°ç‹±

**ä½ç½®**: `backend/routes/dashboardRoutes.js`, `backend/routes/authRoutes.js`

**å½±å“**: ä»£ç å¯è¯»æ€§å·®ï¼Œé”™è¯¯å¤„ç†å›°éš¾

**ä¿®å¤æ–¹æ¡ˆ**: ä½¿ç”¨ `util.promisify` æˆ– `better-sqlite3` åŒ…è£…SQLiteæ“ä½œ

##### ğŸŸ¡ é—®é¢˜2: ä»£ç é‡å¤

**ä½ç½®**: å¤šä¸ªè·¯ç”±æ–‡ä»¶ä¸­çš„åˆ†é¡µé€»è¾‘

**ç¤ºä¾‹**:
```javascript
// åœ¨ materialRoutes.js, inventoryRoutes.js, stocktakingRoutes.js ä¸­é‡å¤
const { page = 1, pageSize = 10 } = req.query;
const offset = (page - 1) * pageSize;
const limit = parseInt(pageSize);
```

**ä¿®å¤æ–¹æ¡ˆ**: æå–ä¸ºä¸­é—´ä»¶
```javascript
const paginationMiddleware = (req, res, next) => {
  req.pagination = {
    page: parseInt(req.query.page) || 1,
    pageSize: parseInt(req.query.pageSize) || 10,
    offset: (parseInt(req.query.page) - 1) * parseInt(req.query.pageSize) || 0,
    limit: parseInt(req.query.pageSize) || 10
  };
  next();
};
```

##### ğŸŸ¡ é—®é¢˜3: ç¼ºå°‘æœåŠ¡å±‚

**å½“å‰**: ä¸šåŠ¡é€»è¾‘ç›´æ¥å†™åœ¨è·¯ç”±ä¸­

**å»ºè®®**: å¼•å…¥Serviceå±‚
```
backend/
â”œâ”€â”€ routes/          # ä»…å¤„ç†HTTPè¯·æ±‚/å“åº”
â”œâ”€â”€ services/        # ä¸šåŠ¡é€»è¾‘å±‚ï¼ˆæ–°å¢ï¼‰
â”‚   â”œâ”€â”€ materialService.js
â”‚   â”œâ”€â”€ inventoryService.js
â”‚   â””â”€â”€ userService.js
â”œâ”€â”€ models/          # æ•°æ®æ¨¡å‹å±‚ï¼ˆæ–°å¢ï¼‰
â””â”€â”€ repositories/    # æ•°æ®è®¿é—®å±‚ï¼ˆæ–°å¢ï¼‰
```

### 3.2 ä¾èµ–ä¸é…ç½®ç®¡ç†

#### å½“å‰çŠ¶æ€

**ä¾èµ–ç®¡ç†**: `package.json` ä½¿ç”¨ `^` ç‰ˆæœ¬èŒƒå›´  
**é…ç½®ç®¡ç†**: éƒ¨åˆ†ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼Œéƒ¨åˆ†ç¡¬ç¼–ç 

#### å‘ç°çš„é—®é¢˜

##### ğŸŸ¡ é—®é¢˜1: ä¾èµ–ç‰ˆæœ¬æœªé”å®š

**é—®é¢˜**: `package.json` ä½¿ç”¨ `^`ï¼Œå¯èƒ½å¯¼è‡´ä¸åŒç¯å¢ƒç‰ˆæœ¬ä¸ä¸€è‡´

**ä¿®å¤æ–¹æ¡ˆ**:
```bash
# ç”Ÿæˆ package-lock.jsonï¼ˆå·²å­˜åœ¨ï¼‰
npm install

# æˆ–ä½¿ç”¨ yarn.lock
yarn install
```

##### ğŸŸ¡ é—®é¢˜2: é…ç½®ç¡¬ç¼–ç 

**ä½ç½®**: 
- `backend/database/database.js:4` - æ•°æ®åº“è·¯å¾„
- `backend/server.js:18` - ç«¯å£å·ï¼ˆæœ‰é»˜è®¤å€¼ï¼‰

**ä¿®å¤æ–¹æ¡ˆ**: å…¨éƒ¨ç¯å¢ƒå˜é‡åŒ–
```javascript
const DB_PATH = process.env.DB_PATH || path.join(__dirname, 'mms.db');
const PORT = process.env.PORT || 3000;
```

##### ğŸŸ¢ é—®é¢˜3: ç¼ºå°‘é…ç½®éªŒè¯

**å»ºè®®**: ä½¿ç”¨ `joi` æˆ– `zod` éªŒè¯ç¯å¢ƒå˜é‡
```javascript
const Joi = require('joi');
const envSchema = Joi.object({
  NODE_ENV: Joi.string().valid('development', 'production').required(),
  PORT: Joi.number().default(3000),
  JWT_SECRET: Joi.string().min(32).required(),
  DB_PATH: Joi.string().optional()
}).unknown();
const { error, value } = envSchema.validate(process.env);
if (error) throw new Error(`ç¯å¢ƒå˜é‡é…ç½®é”™è¯¯: ${error.message}`);
```

### 3.3 æµ‹è¯•è¦†ç›–

#### å½“å‰çŠ¶æ€

**æµ‹è¯•æ–‡ä»¶**: 0ä¸ª  
**æµ‹è¯•æ¡†æ¶**: æœªé…ç½®

#### å»ºè®®

##### ğŸŸ¡ ä¼˜å…ˆçº§1: å•å…ƒæµ‹è¯•

**æ¡†æ¶é€‰æ‹©**: Jest + Supertest

**æµ‹è¯•èŒƒå›´**:
- ä¸šåŠ¡é€»è¾‘å‡½æ•°ï¼ˆå¦‚ï¼š`generateTransactionCode`ï¼‰
- ä¸­é—´ä»¶ï¼ˆ`authenticateToken`, `checkRole`ï¼‰
- å·¥å…·å‡½æ•°

**ç¤ºä¾‹**:
```javascript
// __tests__/utils/generateTransactionCode.test.js
describe('generateTransactionCode', () => {
  it('should generate IN prefix for inbound', () => {
    const code = generateTransactionCode('in');
    expect(code).toMatch(/^IN/);
  });
});
```

##### ğŸŸ¡ ä¼˜å…ˆçº§2: é›†æˆæµ‹è¯•

**æµ‹è¯•èŒƒå›´**:
- APIç«¯ç‚¹ï¼ˆç™»å½•ã€åˆ›å»ºç‰©æ–™ã€å®¡æ‰¹æµç¨‹ï¼‰
- æ•°æ®åº“æ“ä½œ

**ç¤ºä¾‹**:
```javascript
// __tests__/routes/auth.test.js
describe('POST /api/auth/login', () => {
  it('should return token for valid credentials', async () => {
    const res = await request(app)
      .post('/api/auth/login')
      .send({ username: 'admin', password: 'admin123' });
    expect(res.status).toBe(200);
    expect(res.body.data.token).toBeDefined();
  });
});
```

##### ğŸŸ¢ ä¼˜å…ˆçº§3: E2Eæµ‹è¯•

**æ¡†æ¶**: Playwrightï¼ˆå·²åœ¨é¡¹ç›®ä¸­ä½¿ç”¨ï¼‰

**æµ‹è¯•åœºæ™¯**:
- å®Œæ•´ç‰©æ–™å‡ºå…¥åº“æµç¨‹
- ç”¨æˆ·æƒé™éªŒè¯
- å®¡æ‰¹å·¥ä½œæµ

---

## ç¬¬å››éƒ¨åˆ†ï¼šæ¶æ„æ¼”è¿›è¯„ä¼°

### 4.1 è§£è€¦ä¸è¾¹ç•Œ

#### å½“å‰æ¶æ„

**ç±»å‹**: å•ä½“æ¶æ„ï¼ˆMonolithï¼‰  
**å‰åç«¯**: åˆ†ç¦»éƒ¨ç½²ï¼Œé€šè¿‡RESTful APIé€šä¿¡  
**æ•°æ®åº“**: SQLiteæ–‡ä»¶æ•°æ®åº“

#### è¯„ä¼°ç»“æœ

**ä¼˜ç‚¹**:
- âœ… å‰åç«¯è§£è€¦è‰¯å¥½ï¼ŒAPIå¥‘çº¦æ¸…æ™°
- âœ… é€‚åˆå½“å‰è§„æ¨¡å’Œå›¢é˜Ÿç»“æ„
- âœ… éƒ¨ç½²ç®€å•ï¼Œè¿ç»´æˆæœ¬ä½

**æ¼”è¿›å»ºè®®**:

##### ğŸŸ¢ çŸ­æœŸï¼ˆä¿æŒå•ä½“ï¼‰

**ç†ç”±**: 
- å½“å‰ç”¨æˆ·è§„æ¨¡å’Œæ•°æ®é‡è¾ƒå°
- å›¢é˜Ÿè§„æ¨¡é€‚åˆå•ä½“æ¶æ„
- ä¸šåŠ¡å¤æ‚åº¦ä¸é«˜

**ä¼˜åŒ–æ–¹å‘**:
- å¼•å…¥Serviceå±‚åˆ†ç¦»ä¸šåŠ¡é€»è¾‘
- ç»Ÿä¸€é”™è¯¯å¤„ç†å’Œå“åº”æ ¼å¼
- å®Œå–„APIæ–‡æ¡£ï¼ˆSwagger/OpenAPIï¼‰

##### ğŸŸ¡ ä¸­æœŸï¼ˆå¾®æœåŠ¡åŒ–è¯„ä¼°ï¼‰

**è§¦å‘æ¡ä»¶**:
- ç”¨æˆ·æ•° > 1000
- æ—¥è¯·æ±‚é‡ > 10ä¸‡
- å›¢é˜Ÿè§„æ¨¡ > 10äºº
- éœ€è¦ç‹¬ç«‹æ‰©å±•æŸä¸ªæ¨¡å—

**æ‹†åˆ†å»ºè®®**:
```
æœåŠ¡æ‹†åˆ†:
â”œâ”€â”€ auth-service      # è®¤è¯æˆæƒæœåŠ¡
â”œâ”€â”€ material-service  # ç‰©æ–™ç®¡ç†æœåŠ¡
â”œâ”€â”€ inventory-service # å‡ºå…¥åº“æœåŠ¡
â””â”€â”€ notification-service # é€šçŸ¥æœåŠ¡ï¼ˆæœªæ¥ï¼‰
```

### 4.2 çŠ¶æ€ç®¡ç†

#### å½“å‰çŠ¶æ€

**å‰ç«¯çŠ¶æ€ç®¡ç†**: Pinia  
**ä½¿ç”¨æƒ…å†µ**: ä»… `user.js` storeï¼Œç®¡ç†ç”¨æˆ·ç™»å½•çŠ¶æ€

#### è¯„ä¼°ç»“æœ

**ä¼˜ç‚¹**:
- âœ… ä½¿ç”¨åˆç†ï¼Œæœªè¿‡åº¦ä½¿ç”¨å…¨å±€çŠ¶æ€
- âœ… ç»„ä»¶æœ¬åœ°çŠ¶æ€ä½¿ç”¨æ°å½“

**å»ºè®®**: ä¿æŒå½“å‰ä½¿ç”¨æ–¹å¼ï¼Œé¿å…çŠ¶æ€æ»¥ç”¨

### 4.3 å®¹å™¨åŒ–å°±ç»ªåº¦è¯„ä¼°

#### å½“å‰çŠ¶æ€

**å®¹å™¨åŒ–**: âŒ æœªå®¹å™¨åŒ–  
**Dockerfile**: âŒ ä¸å­˜åœ¨  
**docker-compose.yml**: âŒ ä¸å­˜åœ¨

#### å®¹å™¨åŒ–æ”¹é€ ç‚¹

##### ğŸ”´ å¿…é¡»æ”¹é€ é¡¹

1. **åˆ›å»ºDockerfile**
   - åç«¯Dockerfileï¼ˆNode.jsï¼‰
   - å‰ç«¯Dockerfileï¼ˆNginxï¼‰

2. **ç¯å¢ƒå˜é‡åŒ–**
   - æ•°æ®åº“è·¯å¾„
   - JWTå¯†é’¥
   - ç«¯å£é…ç½®

3. **æ—¥å¿—è¾“å‡º**
   - æ”¹ä¸ºæ ‡å‡†è¾“å‡ºï¼ˆstdout/stderrï¼‰
   - ç§»é™¤æ–‡ä»¶æ—¥å¿—ï¼ˆæˆ–é…ç½®æ—¥å¿—é©±åŠ¨ï¼‰

4. **å¥åº·æ£€æŸ¥ç«¯ç‚¹**
   - å·²å­˜åœ¨ï¼š`/api/health`
   - éœ€å¢å¼ºï¼šæ£€æŸ¥æ•°æ®åº“è¿æ¥

5. **é™æ€èµ„æºå¤„ç†**
   - å‰ç«¯æ„å»ºäº§ç‰©éœ€é€šè¿‡NginxæœåŠ¡
   - åç«¯ä¸Šä¼ æ–‡ä»¶éœ€ä½¿ç”¨å¤–éƒ¨å­˜å‚¨ï¼ˆOSSï¼‰

##### ğŸŸ¡ å»ºè®®æ”¹é€ é¡¹

6. **æ•°æ®åº“å¤–éƒ¨åŒ–**
   - SQLiteä¸é€‚åˆå®¹å™¨åŒ–ï¼ˆæ•°æ®æŒä¹…åŒ–é—®é¢˜ï¼‰
   - è¿ç§»è‡³PostgreSQL/MySQLæˆ–ä½¿ç”¨VolumeæŒ‚è½½

7. **é…ç½®æ–‡ä»¶å¤–éƒ¨åŒ–**
   - ä½¿ç”¨ConfigMapï¼ˆK8sï¼‰æˆ–ç¯å¢ƒå˜é‡

8. **å¤šé˜¶æ®µæ„å»º**
   - ä¼˜åŒ–é•œåƒå¤§å°
   - åˆ†ç¦»æ„å»ºå’Œè¿è¡Œç¯å¢ƒ

**è¯¦ç»†æ”¹é€ æ–¹æ¡ˆè§ã€Šé˜¿é‡Œäº‘ECSè¿ç§»å‡†å¤‡æ¸…å•ã€‹**

---

## ä¼˜å…ˆçº§æ’åºåçš„è¡ŒåŠ¨é¡¹

### P0 - ç´§æ€¥ï¼ˆ1-2å‘¨å†…å®Œæˆï¼‰

| åºå· | ä»»åŠ¡ | æ–‡ä»¶/ä½ç½® | é¢„ä¼°å·¥æ—¶ | è´Ÿè´£äºº |
|------|------|-----------|---------|--------|
| P0-1 | ä¿®å¤JWTå¯†é’¥ç¡¬ç¼–ç é—®é¢˜ | `backend/middleware/authMiddleware.js`<br>`backend/routes/authRoutes.js` | 2h | åç«¯å¼€å‘ |
| P0-2 | åˆ›å»ºæ•°æ®åº“ç´¢å¼• | `backend/database/database.js` | 4h | åç«¯å¼€å‘ |
| P0-3 | ä¿®å¤é”™è¯¯ä¿¡æ¯æ³„éœ² | `backend/server.js` | 2h | åç«¯å¼€å‘ |
| P0-4 | ç¯å¢ƒå˜é‡å¼ºåˆ¶éªŒè¯ | `backend/server.js` | 2h | åç«¯å¼€å‘ |

**æ€»è®¡**: 10å°æ—¶

### P1 - é«˜ä¼˜å…ˆçº§ï¼ˆ2-4å‘¨å†…å®Œæˆï¼‰

| åºå· | ä»»åŠ¡ | æ–‡ä»¶/ä½ç½® | é¢„ä¼°å·¥æ—¶ | è´Ÿè´£äºº |
|------|------|-----------|---------|--------|
| P1-1 | é‡æ„Dashboardå¹¶è¡ŒæŸ¥è¯¢ | `backend/routes/dashboardRoutes.js` | 4h | åç«¯å¼€å‘ |
| P1-2 | å¼•å…¥express-validator | æ‰€æœ‰è·¯ç”±æ–‡ä»¶ | 8h | åç«¯å¼€å‘ |
| P1-3 | é…ç½®å‰ç«¯ä»£ç åˆ†å‰² | `frontend/vite.config.js` | 2h | å‰ç«¯å¼€å‘ |
| P1-4 | æ·»åŠ APIå“åº”å‹ç¼© | `backend/server.js` | 1h | åç«¯å¼€å‘ |
| P1-5 | æ·»åŠ è¯·æ±‚é™æµ | `backend/server.js` | 2h | åç«¯å¼€å‘ |
| P1-6 | å®ç°JWTåˆ·æ–°æœºåˆ¶ | `backend/routes/authRoutes.js` | 6h | åç«¯å¼€å‘ |
| P1-7 | æ–‡ä»¶ä¸Šä¼ å®‰å…¨åŠ å›º | `backend/routes/profileRoutes.js` | 3h | åç«¯å¼€å‘ |

**æ€»è®¡**: 26å°æ—¶

### P2 - ä¼˜åŒ–é¡¹ï¼ˆ1-2ä¸ªæœˆå†…å®Œæˆï¼‰

| åºå· | ä»»åŠ¡ | æ–‡ä»¶/ä½ç½® | é¢„ä¼°å·¥æ—¶ | è´Ÿè´£äºº |
|------|------|-----------|---------|--------|
| P2-1 | å¼•å…¥ç»“æ„åŒ–æ—¥å¿—ï¼ˆwinstonï¼‰ | `backend/server.js` | 4h | åç«¯å¼€å‘ |
| P2-2 | æå–åˆ†é¡µä¸­é—´ä»¶ | æ–°å»º `backend/middleware/pagination.js` | 2h | åç«¯å¼€å‘ |
| P2-3 | å¼•å…¥Serviceå±‚ | æ–°å»º `backend/services/` | 16h | åç«¯å¼€å‘ |
| P2-4 | é…ç½®å•å…ƒæµ‹è¯•æ¡†æ¶ | æ–°å»º `__tests__/` | 8h | å…¨æ ˆå¼€å‘ |
| P2-5 | ç¼–å†™æ ¸å¿ƒä¸šåŠ¡å•å…ƒæµ‹è¯• | `__tests__/` | 16h | å…¨æ ˆå¼€å‘ |
| P2-6 | ä¼˜åŒ–EChartså¤§æ•°æ®æ¸²æŸ“ | `frontend/src/views/Dashboard.vue` | 4h | å‰ç«¯å¼€å‘ |
| P2-7 | å®ç°æ¸¸æ ‡åˆ†é¡µ | æ‰€æœ‰åˆ—è¡¨æŸ¥è¯¢è·¯ç”± | 8h | åç«¯å¼€å‘ |
| P2-8 | æ·»åŠ ETagç¼“å­˜ | `backend/server.js` | 2h | åç«¯å¼€å‘ |

**æ€»è®¡**: 60å°æ—¶

---

## åˆ†é˜¶æ®µå®æ–½è®¡åˆ’

### v1.1 - çƒ­ä¿®å¤ä¸å®‰å…¨åŠ å›ºï¼ˆ2å‘¨ï¼‰

**ç›®æ ‡**: ä¿®å¤P0é—®é¢˜ï¼Œæå‡ç³»ç»Ÿå®‰å…¨æ€§

**äº¤ä»˜ç‰©**:
- âœ… JWTå¯†é’¥ç¯å¢ƒå˜é‡åŒ–
- âœ… æ•°æ®åº“ç´¢å¼•åˆ›å»º
- âœ… é”™è¯¯å¤„ç†å®‰å…¨åŠ å›º
- âœ… ç¯å¢ƒå˜é‡éªŒè¯

**éªŒæ”¶æ ‡å‡†**:
- æ‰€æœ‰P0é—®é¢˜å·²ä¿®å¤
- å®‰å…¨æ‰«ææ— é«˜å±æ¼æ´
- æ€§èƒ½æµ‹è¯•é€šè¿‡ï¼ˆç´¢å¼•ç”Ÿæ•ˆï¼‰

### v1.5 - æ€§èƒ½ä¸è´¨é‡æå‡ï¼ˆ4å‘¨ï¼‰

**ç›®æ ‡**: è§£å†³P1é—®é¢˜ï¼Œæå‡ç³»ç»Ÿæ€§èƒ½å’Œä»£ç è´¨é‡

**äº¤ä»˜ç‰©**:
- âœ… Dashboardå¹¶è¡ŒæŸ¥è¯¢é‡æ„
- âœ… ç»Ÿä¸€è¾“å…¥éªŒè¯
- âœ… å‰ç«¯ä»£ç åˆ†å‰²
- âœ… APIå“åº”å‹ç¼©å’Œé™æµ
- âœ… JWTåˆ·æ–°æœºåˆ¶

**éªŒæ”¶æ ‡å‡†**:
- DashboardåŠ è½½æ—¶é—´ < 200ms
- APIå“åº”æ—¶é—´æå‡30%
- å‰ç«¯é¦–å±åŠ è½½æ—¶é—´ < 2s
- ä»£ç è¦†ç›–ç‡ > 60%

### v2.0 - æ¶æ„æ¼”è¿›ï¼ˆ8å‘¨ï¼‰

**ç›®æ ‡**: å®ŒæˆP2ä¼˜åŒ–ï¼Œä¸ºå®¹å™¨åŒ–å’Œäº‘è¿ç§»åšå‡†å¤‡

**äº¤ä»˜ç‰©**:
- âœ… Serviceå±‚é‡æ„
- âœ… ç»“æ„åŒ–æ—¥å¿—ç³»ç»Ÿ
- âœ… å•å…ƒæµ‹è¯•è¦†ç›–æ ¸å¿ƒä¸šåŠ¡
- âœ… å®¹å™¨åŒ–æ”¹é€ ï¼ˆDockerfileï¼‰
- âœ… æ•°æ®åº“è¿ç§»æ–¹æ¡ˆï¼ˆSQLite â†’ PostgreSQLï¼‰

**éªŒæ”¶æ ‡å‡†**:
- ä»£ç è¦†ç›–ç‡ > 80%
- å®¹å™¨åŒ–éƒ¨ç½²æˆåŠŸ
- æ•°æ®åº“è¿ç§»æµ‹è¯•é€šè¿‡
- æ¶æ„æ–‡æ¡£å®Œæ•´

---

## é£é™©ä¸ä¾èµ–é¡¹

### æŠ€æœ¯é£é™©

1. **æ•°æ®åº“è¿ç§»é£é™©**
   - **é£é™©**: SQLite â†’ PostgreSQLè¿ç§»å¯èƒ½ä¸¢å¤±æ•°æ®
   - **ç¼“è§£**: å……åˆ†æµ‹è¯•ï¼Œåˆ¶å®šå›æ»šæ–¹æ¡ˆ

2. **å®¹å™¨åŒ–å…¼å®¹æ€§é£é™©**
   - **é£é™©**: SQLiteæ–‡ä»¶æ•°æ®åº“åœ¨å®¹å™¨ä¸­æ•°æ®æŒä¹…åŒ–é—®é¢˜
   - **ç¼“è§£**: ä½¿ç”¨VolumeæŒ‚è½½æˆ–è¿ç§»è‡³PostgreSQL

3. **æ€§èƒ½ä¼˜åŒ–é£é™©**
   - **é£é™©**: ç´¢å¼•åˆ›å»ºå¯èƒ½å½±å“ç°æœ‰æŸ¥è¯¢
   - **ç¼“è§£**: åœ¨æµ‹è¯•ç¯å¢ƒå……åˆ†éªŒè¯

### ä¾èµ–é¡¹

1. **å¤–éƒ¨ä¾èµ–**:
   - Node.js >= 16.0.0
   - npm >= 8.0.0
   - Dockerï¼ˆå®¹å™¨åŒ–éœ€è¦ï¼‰

2. **å›¢é˜Ÿä¾èµ–**:
   - åç«¯å¼€å‘äººå‘˜ï¼ˆNode.js/Expressï¼‰
   - å‰ç«¯å¼€å‘äººå‘˜ï¼ˆVue 3ï¼‰
   - DevOpsäººå‘˜ï¼ˆå®¹å™¨åŒ–éƒ¨ç½²ï¼‰

3. **æ—¶é—´ä¾èµ–**:
   - v1.1å¿…é¡»åœ¨v1.5ä¹‹å‰å®Œæˆ
   - v1.5å¿…é¡»åœ¨v2.0ä¹‹å‰å®Œæˆ

---

## é™„å½•

### A. æ•°æ®åº“ç´¢å¼•åˆ›å»ºè„šæœ¬

è§"ç¬¬ä¸€éƒ¨åˆ†ï¼šæ€§èƒ½ä¸å¯æ‰©å±•æ€§å®¡è®¡ - 1.1 æ•°æ®åº“å±‚é¢åˆ†æ - é—®é¢˜1"

### B. ç¯å¢ƒå˜é‡é…ç½®æ¨¡æ¿

```bash
# .env.example
NODE_ENV=production
PORT=3000
JWT_SECRET=your-super-secret-jwt-key-min-32-chars
JWT_EXPIRES_IN=7d
DB_PATH=/data/mms.db
LOG_LEVEL=info
```

### C. æ€§èƒ½åŸºå‡†æµ‹è¯•ç»“æœ

**å½“å‰æ€§èƒ½**ï¼ˆ1000æ¡æ•°æ®ï¼‰:
- DashboardåŠ è½½: 150ms
- ç‰©æ–™åˆ—è¡¨æŸ¥è¯¢: 80ms
- å‡ºå…¥åº“å•åˆ—è¡¨: 120ms

**ä¼˜åŒ–åç›®æ ‡**:
- DashboardåŠ è½½: < 50ms
- ç‰©æ–™åˆ—è¡¨æŸ¥è¯¢: < 30ms
- å‡ºå…¥åº“å•åˆ—è¡¨: < 40ms

---

**æ–‡æ¡£ç»“æŸ**

